import {
  FlowGraphExecutionBlockWithOutSignal
} from "./chunk-OULTPVR4.js";
import {
  RichTypeAny
} from "./chunk-VZX2R3NQ.js";
import {
  RegisterClass
} from "./chunk-S7NDMBDF.js";

// node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/flowGraphSetVariableBlock.js
var FlowGraphSetVariableBlock = class extends FlowGraphExecutionBlockWithOutSignal {
  constructor(config) {
    super(config);
    if (!config.variable && !config.variables) {
      throw new Error("FlowGraphSetVariableBlock: variable/variables is not defined");
    }
    if (config.variables && config.variable) {
      throw new Error("FlowGraphSetVariableBlock: variable and variables are both defined");
    }
    if (config.variables) {
      for (const variable of config.variables) {
        this.registerDataInput(variable, RichTypeAny);
      }
    } else {
      this.registerDataInput("value", RichTypeAny);
    }
  }
  _execute(context, _callingSignal) {
    var _a, _b;
    if ((_a = this.config) == null ? void 0 : _a.variables) {
      for (const variable of this.config.variables) {
        this._saveVariable(context, variable);
      }
    } else {
      this._saveVariable(context, (_b = this.config) == null ? void 0 : _b.variable, "value");
    }
    this.out._activateSignal(context);
  }
  _saveVariable(context, variableName, inputName) {
    var _a;
    const currentlyRunningAnimationGroups = context._getGlobalContextVariable("currentlyRunningAnimationGroups", []);
    for (const animationUniqueId of currentlyRunningAnimationGroups) {
      const animationGroup = context.assetsContext.animationGroups.find((animationGroup2) => animationGroup2.uniqueId == animationUniqueId);
      if (animationGroup) {
        for (const targetAnimation of animationGroup.targetedAnimations) {
          if (targetAnimation.target === context) {
            if (targetAnimation.animation.targetProperty === variableName) {
              animationGroup.stop();
              const index = currentlyRunningAnimationGroups.indexOf(animationUniqueId);
              if (index > -1) {
                currentlyRunningAnimationGroups.splice(index, 1);
              }
              context._setGlobalContextVariable("currentlyRunningAnimationGroups", currentlyRunningAnimationGroups);
              break;
            }
          }
        }
      }
    }
    const value = (_a = this.getDataInput(inputName || variableName)) == null ? void 0 : _a.getValue(context);
    context.setVariable(variableName, value);
  }
  getClassName() {
    return "FlowGraphSetVariableBlock";
  }
  serialize(serializationObject) {
    var _a;
    super.serialize(serializationObject);
    serializationObject.config.variable = (_a = this.config) == null ? void 0 : _a.variable;
  }
};
RegisterClass("FlowGraphSetVariableBlock", FlowGraphSetVariableBlock);

export {
  FlowGraphSetVariableBlock
};
//# sourceMappingURL=chunk-N6TAT4RJ.js.map

import{dC as W,bf as Y,V as s,i as G,bo as P,dL as y,ag as U,_ as b,ah as O,f as B,s as Z,x as q,P as k,J as X,R as J}from"./main-cbd8a0ec.js";class A{constructor(e,a,r,n){this.name=e,this.worldAxisForNormal=a,this.worldAxisForFileX=r,this.worldAxisForFileY=n}}class x{static ConvertCubeMapTextureToSphericalPolynomial(e){var w;if(!e.isCube)return null;(w=e.getScene())==null||w.getEngine().flushFramebuffer();const a=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),n=e.readPixels(1,void 0,void 0,!1);let i,t;e.isRenderTarget?(i=e.readPixels(3,void 0,void 0,!1),t=e.readPixels(2,void 0,void 0,!1)):(i=e.readPixels(2,void 0,void 0,!1),t=e.readPixels(3,void 0,void 0,!1));const d=e.readPixels(4,void 0,void 0,!1),g=e.readPixels(5,void 0,void 0,!1),f=e.gammaSpace,z=5;let C=0;return(e.textureType==1||e.textureType==2)&&(C=1),new Promise(E=>{Promise.all([n,r,i,t,d,g]).then(([F,u,m,h,p,_])=>{const R={size:a,right:u,left:F,up:m,down:h,front:p,back:_,format:z,type:C,gammaSpace:f};E(this.ConvertCubeMapToSphericalPolynomial(R))})})}static _AreaElement(e,a){return Math.atan2(e*a,Math.sqrt(e*e+a*a+1))}static ConvertCubeMapToSphericalPolynomial(e){const a=new W;let r=0;const n=2/e.size,i=n,t=.5*n,d=t-1;for(let w=0;w<6;w++){const E=this._FileFaces[w],F=e[E.name];let u=d;const m=e.format===5?4:3;for(let h=0;h<e.size;h++){let p=d;for(let _=0;_<e.size;_++){const R=E.worldAxisForFileX.scale(p).add(E.worldAxisForFileY.scale(u)).add(E.worldAxisForNormal);R.normalize();const v=this._AreaElement(p-t,u-t)-this._AreaElement(p-t,u+t)-this._AreaElement(p+t,u-t)+this._AreaElement(p+t,u+t);let l=F[h*e.size*m+_*m+0],o=F[h*e.size*m+_*m+1],c=F[h*e.size*m+_*m+2];isNaN(l)&&(l=0),isNaN(o)&&(o=0),isNaN(c)&&(c=0),e.type===0&&(l/=255,o/=255,c/=255),e.gammaSpace&&(l=Math.pow(P(l),y),o=Math.pow(P(o),y),c=Math.pow(P(c),y));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const D=Math.max(l,o,c);if(D>T){const V=T/D;l*=V,o*=V,c*=V}}else l=P(l,0,T),o=P(o,0,T),c=P(c,0,T);const H=new G(l,o,c);a.addLight(R,H,v),r+=v,p+=n}u+=i}}const C=4*Math.PI*6/6/r;return a.scaleInPlace(C),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),Y.FromHarmonics(a)}}x._FileFaces=[new A("right",new s(1,0,0),new s(0,0,-1),new s(0,-1,0)),new A("left",new s(-1,0,0),new s(0,0,1),new s(0,-1,0)),new A("up",new s(0,1,0),new s(1,0,0),new s(0,0,1)),new A("down",new s(0,-1,0),new s(1,0,0),new s(0,0,-1)),new A("front",new s(0,0,1),new s(1,0,0),new s(0,-1,0)),new A("back",new s(0,0,-1),new s(-1,0,0),new s(0,-1,0))];x.MAX_HDRI_VALUE=4096;x.PRESERVE_CLAMPED_COLORS=!1;class S extends U{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([b(()=>import("./pass.fragment-7974f568.js"),["assets/pass.fragment-7974f568.js","assets/main-cbd8a0ec.js","assets/index-ad665221.css"])]))):a.push(Promise.all([b(()=>import("./pass.fragment-ba7aaffd.js"),["assets/pass.fragment-ba7aaffd.js","assets/main-cbd8a0ec.js","assets/index-ad665221.css"])])),super._gatherImports(e,a)}constructor(e,a=null,r){const n={name:e,engine:a||O.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:S.FragmentUrl,...r};n.engine||(n.engine=O.LastCreatedEngine),super(n)}}S.FragmentUrl="pass";class I extends U{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([b(()=>import("./passCube.fragment-f812dd67.js"),["assets/passCube.fragment-f812dd67.js","assets/main-cbd8a0ec.js","assets/index-ad665221.css"])]))):a.push(Promise.all([b(()=>import("./passCube.fragment-f0d2fd88.js"),["assets/passCube.fragment-f0d2fd88.js","assets/main-cbd8a0ec.js","assets/index-ad665221.css"])])),super._gatherImports(e,a)}constructor(e,a=null,r){super({...r,name:e,engine:a||O.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:I.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ");break}}}I.FragmentUrl="passCube";class L extends k{getClassName(){return"PassPostProcess"}constructor(e,a,r=null,n,i,t,d=0,g=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:n,engine:i,reusable:t,textureType:d,blockCompilation:g,...a};super(e,S.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new S(e,i,f):void 0,...f})}static _Parse(e,a,r,n){return X.Parse(()=>new L(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,n)}}J("BABYLON.PassPostProcess",L);class N extends k{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,a,r=null,n,i,t,d=0,g=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:n,engine:i,reusable:t,textureType:d,blockCompilation:g,...a};super(e,S.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new I(e,i,f):void 0,...f})}static _Parse(e,a,r,n){return X.Parse(()=>new N(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,n)}}B([Z()],N.prototype,"face",null);q._RescalePostProcessFactory=M=>new L("rescale",1,null,2,M,!1,0);export{x as C,L as P,S as T,I as a};
